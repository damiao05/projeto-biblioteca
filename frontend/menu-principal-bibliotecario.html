<style>

    html {
        overflow-y: none;
    }

    header {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 60px;
        background: -webkit-linear-gradient(
        to right, #986c4a,
                #9d5218);
        background: linear-gradient(
            to right, #b57747,
                #5e3211);
        color: #f7f5e9;
        display: flex;
        align-items: center;
        flex-direction: row;
        /* justify-content: flex-start; */
        gap: 1rem;
        padding: 0 2px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        z-index: 5000;
    }

    body {
        height: 100%;
        background: #f7f5e9;
        margin: 0;
        margin-top: -1.25rem;
        font-family: 'Work Sans', sans-serif;
        /* margin-top: 60px; */
    }

    ::-webkit-scrollbar-track {
        background-color: transparent;
    }
    ::-webkit-scrollbar {
        width: 0.6rem;
        /* background: #986c4a; */
    }
    ::-webkit-scrollbar-thumb {
        background: #986c4a;
        border-radius: 6px;
    }

    .conteudo-body {
        opacity: 0;
        transition: opacity 0.5s ease-out;
    }

    .mostrar {
        opacity: 1;
    }

    .container-livros {
        width: 80%;
        margin: 20px auto;
        padding: 20px;
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(15rem, 1fr));
        gap: 2.5rem;
    }

    .capa-livro {
        display: block;
        width: 100%;
        object-fit: cover;
        background-color: #eee;
    }

    .book-card {
        display: flex;
        flex-direction: column;
        /* justify-content: center; */
        align-items: center;
        background: -webkit-linear-gradient(
        to right, #986c4a,
                #9d5218);
        background: linear-gradient(
            to right, #b57747,
                #5e3211);
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        cursor: pointer;
    }

    .img-capa {
        overflow: hidden;
        object-fit: cover;
        width: 95%;
        aspect-ratio: 2/3;
        display: flex;
        justify-content: center;
        align-items: center;
        border-radius: 8px;
        margin-top: 3%;
    }

    .book-info {
        padding: 1.2rem;
        text-align: center;
        letter-spacing: .025rem;
        color: #f7f5e9;
        height: 10%;
    }

    .book-info h3 {
        font-size: 1rem;
        margin: 0;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        font-weight: 800;
    }

    .book-info span {
        font-size: 0.9em;
        margin: 0;
    }

    .capa-livro {
        display: block;
        width: 100%;
        aspect-ratio: 2/3;
        /* object-fit: cover; */
        background-color: #eee;
        border-radius: 6px;
    }

    .container-infos {
        display: flex;
        background: -webkit-linear-gradient(
        to right, #986c4a,
                #9d5218);
        background: linear-gradient(
            to right, #b57747,
                #5e3211);
        border-radius: 15px;
        width: 50rem;
        height: 35rem;
        margin-top: 2rem;
        opacity: 0;
    }

    .modal-info-livro {
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: rgba(0,0,0,0.5);
        backdrop-filter: blur(2px);
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 1000;

        opacity: 0;
        pointer-events: none;
    }

    #clone-modal {
        background: -webkit-linear-gradient(
        to right, #986c4a,
                #9d5218);
        background: linear-gradient(
            to right, #b57747,
                #5e3211);
    }

    .clone-capa {
        position: fixed;
        z-index: 2001;
        object-fit: cover;

        transition: top 0.7s ease-in-out, left 0.7s ease-in-out, width 0.7s ease-in-out, height 0.7s ease-in-out;
    }

    .clone-info {
        position: fixed;
        margin: 0;
        z-index: 1500;
        object-fit: cover;
        color: #f7f5e9;

        transition: top 0.3s ease-in-out, left 0.3s ease-in-out, width 0.3s ease-in-out, height 0.3s ease-in-out;
    }

    .info-capa-livro {
        width: 100%;
        height: 100%;
        object-fit: cover;
        object-position: center;
    }

    .container-capa-info {
        width: 50%;
        margin: 2rem;
        overflow: hidden;
    }

    .visible {
        opacity: 1;
        pointer-events: all;

    }

    .book-card:hover {
        transform: scale(1.1); 
        background-color: #784b28;
        box-shadow: 8px 8px 90px #b57747;
    }

    .infos-livro {
        width: 50%;
        margin-top: 5rem;
        margin-right: 2rem;
        color: #f7f5e9;
    }

    .infos-livro h2, p {
        margin: 1rem;
    }

    .d-none {
        display: none;
    }

    .fechar-modal {
        color: white;
        font-size: 1.5rem;
        position: fixed;
        transition: top 0.3s ease-in-out, left 0.3s ease-in-out, width 0.3s ease-in-out, height 0.3s ease-in-out;
        opacity: 0;
    }

    .btn-add-livro {
        position: fixed;
        left: 2rem;
        bottom: 2rem;
    }

    .loading-text {
        color: #fff;
        display: inline-block;
        font-size: 2rem;
        font-weight: bold;
        /* font-family: Arial, sans-serif;
        font-size: 1.2em;
        animation: pulseText 1.5s infinite alternate; */
    }

    .loading-text span {
        display: inline-block;
    }

    .tela-loading {
        background: -webkit-linear-gradient(
            to right, #986c4a,
                    #9d5218
        );
        background: linear-gradient(
            to right, #b57747,
                    #5e3211
        );
        width: 100%;
        height: 100%;
        z-index: 9999;
        position: fixed;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        /* perspective: 1000px; */
    }

    .book-loader {
        display: flex;
        align-items: center;
        /* height: 100vh; */
        perspective: 1000px;
        margin-left: 7%;
        height: 130px;
        width: 110px;
        position: relative;
        transform-style: preserve-3d;
        /* overflow: hidden; */
    }

    .pages {
        position: absolute;
        top: 4.5%;
        transform-style: preserve-3d;
    }

    .book-loader.ativo .front-cover {
        transform: rotateX(10deg) rotateY(-180deg);
    }

    .back-cover.fechar {
        transform: rotateX(10deg) rotateY(-175deg);
    }

    .book-loader.ativo .page {
        transform: rotateX(10deg) rotateY(-180deg);
        z-index: 2;
    }

    .book-loader.ativo .page:nth-child(2) {
        transition-duration: 2s;
    }
    .book-loader.ativo .page:nth-child(3) {
        transition-duration: 2s;
    }
    .book-loader.ativo .page:nth-child(4) {
        transition-duration: 2s;
    }
    .book-loader.ativo .page:nth-child(5) {
        transition-duration: 2s;
    }
    .book-loader.ativo .page:nth-child(6) {
        transition-duration: 2s;
    }

    .page, .book-cover, .loading-text span {
        will-change: transform;
    }

    .front-cover, .back-cover {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100%;
        width: 100%;
        background: #550000;
        border-radius: 4px 20px 20px 4px;
        position: absolute;
        box-shadow: 1px 1px 10px rgba(0,0,0,0.3);
        transform: rotateX(10deg);
        overflow: hidden;
    }

    .front-cover {
        z-index: 1;
        transition: all 1.5s;
        transform-origin: center left;
    }

    .escrita-p,
    .escrita-s {
        font-size: 2.5rem;
        color: #a77246;
        font-family: 'Tangerine', cursive;
    }

    .escrita-s {
        display: none;
        font-family: 'Tangerine', cursive;
    }

    .back-cover {
        z-index: 1;
        transition: all 1.5s;
        transform-origin: center left;
    }

    .cover-details {
        display: flex;
        justify-content: center;
        align-items: center;
        border: 1px solid #8a4b56;
        border-radius: 5px 20px 20px 5px;
        width: 92%;
        height: 92%;
    }

    .page {
        height: 120px;
        width: 100px;
        background: white;
        position: absolute;
        border-radius: 2px 10px 10px 2px;
        transform: rotateX(10deg);
        z-index: -1;
        transform-origin: center left;
        transform-style: preserve-3d;
        box-shadow: inset 0 0 5px rgba(0,0,0,0.2);
        /* margin: 1px; */
    }

    .page:nth-child(even) {
        background: linear-gradient(90deg, #fdfdfd 0%, #f5f5f5 50%, #eaeaea 100%);
    }

    .page:nth-child(2) {
    transition-duration: 2s;
    }

    .page:nth-child(3) {
    transition-duration: 2s;
    }
    .page:nth-child(4) {
    transition-duration: 2s;
    }
    .page:nth-child(5) {
    transition-duration: 2s;
    }
    .page:nth-child(6) {
    transition-duration: 2s;
    }

    .lithub {
        position: relative;
        left: 1%;
    }

    .right-group {
        position: relative;
        left: 90%;
    }

    .menu-icon {
        font-size: 1.5rem;
        cursor: pointer;
    }

    .menu-icon:hover {
        transform: scale(1.25);
    }

    .menu-bar {
        display: flex;
        flex-direction: column;
        position: fixed;
        height: 100%;
        width: 100%;
        left: 100%;
        background: -webkit-linear-gradient(
        to right, #986c4a,
                #9d5218);
        background: linear-gradient(75deg, #5e3211, transparent);
        box-shadow: 10px 10px 100px black;
        transition: all .3s ease;
        z-index: 4000;
    }

    .menu-bar.aberto {
        left: 84%;
    }

    .menu-bar span {
        display: flex;
        justify-content: start;
        align-items: center;
        height: 10%;
        border-bottom: 1px solid;
        padding-left: 2rem;
        font-size: 1.1rem;
        font-family: 'Work Sans', sans-serif;
        color: #f7f5e9;
        font-weight: bold;
        cursor: pointer;
    }

    .menu-option:hover {
        background: linear-gradient(75deg, #f7f5e9, transparent);
        color: #986c4a;
    }

    .editar-infos {
        background: #f7f5e9;
        color: #986c4a;
        white-space: nowrap;
        border: none;
        display: flex;
        justify-content: center;
        align-items: center;
        margin-top: 0.3rem;
        line-height: 3.125rem;
        outline: none;
        font-size: 1.125rem;
        letter-spacing: .025rem;
        text-decoration: none;
        cursor: pointer;
        font-weight: 800;
        width: fit-content;
        border-radius: 0.75rem;
        transition: all .3s ease;
        -webkit-transition: all .3s ease;
    }

    .editar-infos:hover {
        background-color: white;
        box-shadow: 2px 2px 30px #f7f5e9;
    }

    .btn-add-livro {
        background-color: #986c4a;
        color: #f7f5e9;
        white-space: nowrap;
        border: none;
        display: flex;
        justify-content: center;
        align-items: center;
        margin-top: 0.5rem;
        line-height: 3.125rem;
        outline: none;
        font-size: 1.125rem;
        letter-spacing: .025rem;
        text-decoration: none;
        cursor: pointer;
        font-weight: 800;
        min-height: 3.125rem;
        /* width: ; */
        aspect-ratio: 1/1;
        border-radius: 0.75rem;
        transition: all .3s ease;
        -webkit-transition: all .3s ease;
    }

    .btn-add-livro span {
        display: none;
    }

    .btn-add-livro:hover span {
        display: block
    }

    .btn-add-livro:hover {
        background-color: #784b28;
        box-shadow: 2px 2px 30px #b57747;
        aspect-ratio: 0;
        width: fit-content;
    }

</style>

<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menu</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
</head>
<body>
    <header>
        <h2 class="lithub">LitHub</h2>

        <div class="right-group">
            <span class="menu-icon"><i class="fa fa-bars"></i></span>
        </div>
    </header>

    <script src="https://cdn.jsdelivr.net/npm/gsap@3.13.0/dist/gsap.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tangerine&display=swap" rel="stylesheet">

    <div class="tela-loading">
        <div class="book-loader">
            <div class="front-cover">
                <div class="cover-details">
                    <span class="escrita-p">P</span>
                </div>
            </div>
            <div class="pages"></div>
            <div class="back-cover">
                <div class="cover-details">
                    <span class="escrita-s">Ƨ</span>
                </div>
            </div>
        </div>
        <p class="loading-text">Carregando...</p> 
    </div>

    <div class="menu-bar">
        <span class="menu-option" id="reservas"><i class="fa-solid fa-book-bookmark"></i> Reservas</span>
        <span class="menu-option" id="emprestimos"><i class="fa-solid fa-right-left"></i> Empréstimos</span>
        <span class="menu-option" id="categorias"><i class="fa-solid fa-layer-group"></i> Categorias</span>
        <span class="menu-option" id="livros"><i class="fa-solid fa-book-open-reader"></i>  Livros</span>
        <span class="menu-option" id="meu-perfil"><i class="fa-solid fa-user-circle"></i>  Meu Perfil</span>
        <span class="menu-option" id="sair"><i class="fa-solid fa-arrow-right-from-bracket"></i>  Sair</span>
    </div>

    <div class="conteudo-body">
        <div class="container-livros"></div>
        <button class="btn-add-livro" type="button"><i class="fa fa-plus"></i> <span>Adicionar Livro</span></button>
    </div>
    
</body>
</html>

<div class="modal-info-livro">
    <span class="fechar-modal"><i class="fa fa-times"></i></span>
    <div class="container-infos">
        <div class="container-capa-info">
            <img src="" alt="" class="info-capa-livro">
        </div>
        <div class="infos-livro">
            <h2 class="titulo-h2"></h2>
            <p class="autor"></p>
            <p class="editora"></p>
            <button type="button" class="editar-infos">Editar Informações</button>
        </div>
    </div>
</div>

<script src="./js/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jwt-decode@3/build/jwt-decode.min.js"></script>
<script src="js/config.js"></script>
<script>

    $(window).on('load', function() {

        const textLoading = document.querySelector('.loading-text');
        const text = textLoading.textContent;
        textLoading.textContent = '';
        const chars = Array.from(text);

        chars.forEach(ch => {
            const span = document.createElement('span');
            span.textContent = ch;
            textLoading.appendChild(span);
        });

        const letters = textLoading.querySelectorAll('span');

        const tl = gsap.timeline({ repeat: -1, repeatDelay: 0, yoyo: true });

        letters.forEach((letter, i) => { // alterna pra cima/baixo
            tl.to(letter, {
                y: -10,
                duration: 0.1,
                ease: "power1.inOut",
                stagger: {
                    repeat: 1,
                    yoyo: true,
                    ease: 0.05 // leve defasagem pra parecer uma onda
                }
            });
        });

        // text.split('').forEach(char => {
        //     const span = document.createElement('span');
        //     span.textContent = char;
        //     textLoading.appendChild(span);
        // });

        // gsap.fromTo('.loading-text span',
        // { y: 0 },
        // {
        //     y: -10,         // altura do “pulo”
        //     repeat: -1,     // loop infinito
        //     yoyo: true,     // sobe e desce
        //     stagger: 0.1,   // atraso entre letras
        //     ease: "power1.inOut",
        //     duration: 0.3
        // }
        // );

        let alteraZIndexPage = 0;
        let apagarPages;
        let adicionarPages;

        const book = document.querySelector('.book-loader');

        function aplicarDuracao() {
            const pages = document.querySelectorAll('.book-loader .page');
            const total = pages.length;

            if (total === 0) return;

            let duracaoBase = 2;
            const decremento = 0.3;
            const duracaoMin = 2;

            pages.forEach((page, i) => {
                const duracao = Math.max(duracaoBase - i * decremento, duracaoMin)
                page.style.transitionDuration = `${duracao.toFixed(2)}s`;

                if(alteraZIndexPage == 1) page.style.zIndex = 2;
            });
        }

        $('html').css({
            overflowY: 'hidden'
        });

        function escondeTelaLoading() {
            clearInterval(adicionarPages);
            clearInterval(apagarPages);
            $(".back-cover").css({ zIndex: 3 });
            setTimeout(() => {
                $(".back-cover").addClass("fechar");

                setTimeout(() => {
                    $(".escrita-s").css({ display: 'block' });
                }, 500);

                document.getElementsByClassName('back-cover')[0].addEventListener('transitionend', () => {
                    const pages = document.querySelectorAll('.book-loader .page');
                    pages.forEach(page => page.style.transition = 'none');
                    document.getElementsByClassName('back-cover')[0].style.transition = 'none';

                    setTimeout(() => {
                        $(".tela-loading").remove();
                        $("body").css({marginTop: "60px"})
                        $('html').css({
                            overflowY: 'scroll'
                        });
                    }, 500);
                })

            }, 250);
        }

        setTimeout(function() {
            $(".book-loader").addClass("ativo");

            setTimeout(() => {
                $(".escrita-p").css({ display: 'none' });
            }, 700)

        }, 500);

        setTimeout(() => {
            const pages = document.querySelectorAll('.book-loader .page');
            pages.forEach((page, i) => {
                page.style.zIndex = 2;
            });

            alteraZIndexPage = 1;
        }, 2800);

        setTimeout(() => {
            apagarPages = setInterval(() => {
                if($(".page")[0]) {
                    $(".page")[0].remove();
                }
            }, 500);
        }, 5000);

        setTimeout(() => {
            const pagesContainer = document.querySelector('.book-loader .pages');
            if (!pagesContainer) return;

            const observer = new MutationObserver((mutations) => {
                for (const mutation of mutations) {
                    if (mutation.type === 'childList' && mutation.addedNodes.length > 0) {
                        aplicarDuracao();

                        const book = document.querySelector('.book-loader');
                        book.classList.remove('ativo');
                        void book.offsetWidth;
                        book.classList.add('ativo');
                    }
                }
            });

            observer.observe(pagesContainer, { childList: true });
        }, 100);

        setTimeout(() => {
            adicionarPages = setInterval(() => {
                $(".pages").append(`
                    <div class="page"></div>
                `);

            }, 180);
        }, 100);

        function fecharLivro() {
            const back = document.querySelector('.back-cover');
            back.style.transformOrigin = 'right center';
            back.style.transition = 'transform 1.5s ease-in-out';
            back.style.transform = 'rotateY(0deg)';
        }

        sessionStorage.setItem('urlAnterior', window.location.href);

        let medidasTitulo;
        let medidasAutor;
        let medidasEditora;
        let medidasCapa;
        let medidasLivroEscolhido;
        let sourceImage;
        let livroEscolhido;

        let informacoesLivros = {};

        function carregarCapas(token) {
            const promises = [];

            $(".capa-livro").each(function() {
                const card = $(this);
                const isbn = card.data("isbn");

                if(!isbn) return;

                const urlCapa = `${API_URL}/livros/${isbn}/capa`;

                const promise = fetch(urlCapa, {
                    headers: { 'Authorization': `Bearer ${token}` }
                })
                .then(response => {
                    if(!response.ok) { throw new Error('Capa não encontrada.'); }
                    return response.blob();
                })
                .then(blob => {
                    const objectURL = URL.createObjectURL(blob);
                    card.attr('src', objectURL);

                    informacoesLivros[`book-${isbn}`]["urlCapa"] = objectURL;
                })
                .catch(error => {
                    console.error(`Erro ao carregar capa para o ISBN ${isbn}:`, error);
                    card.attr('src', 'caminho/para/imagem_padrao.png');
                });
                
                promises.push(promise);
            });


            return Promise.all(promises);
        }

        const token = localStorage.getItem('jwtToken');

        const API_BASE = `${API_URL}/livros`;

        fetch(API_BASE, {
            method: 'GET',
            headers:{ "Content-Type": "application/json",
                "Authorization": `Bearer ${token}`
            }
        }).then(async response => {
            const livros = await response.json();

            livros.forEach(livro => {
                // console.log(livro);

                let urlCapa = `${API_BASE}/${livro.isbn}/capa`;

                informacoesLivros[`book-${livro.isbn}`] = {
                    'isbn': livro.isbn,
                    'titulo': livro.titulo,
                    'autor': livro.autor,
                    'editora': livro.editora
                }

                $(".container-livros").append(`<div class="book-card" id="book-${livro.isbn}""><div class="img-capa"><img class="capa-livro" data-isbn="${livro.isbn}" src="" alt="Capa do Livro ${livro.titulo}"></div><div class="book-info"><h3 id="titulo-livro">${livro.titulo}</h3><span id="autor-livro" style="margin: 0">${livro.autor}</span></div></div>`);
            });

            return carregarCapas(token); 
        }).then(() => {
            $(".conteudo-body").addClass("mostrar");
            setTimeout(() => {
                escondeTelaLoading();
            }, 1000);
        });

        $(".menu-icon").on("click", () => {
            if($(".menu-bar").hasClass("aberto")) {
                $(".menu-bar").removeClass('aberto');
            } else {
                $(".menu-bar").addClass('aberto');
            }
            
        })

        $(".menu-option").on("click", function() {
            window.location.href = `/${$(this)[0].id}.html`;
        });

        $(".container-livros").on("click", function() {
            $(".modal-info-livro").addClass("visible");
            let scrollbarWidth = window.innerWidth - $(document).width();
            document.body.style.paddingRight = `${scrollbarWidth}px`;
            document.body.style.overflow = 'hidden';
            livroEscolhido = $(event.target).parent().parent()[0].id;
            // console.log(livroEscolhido);
            medidasLivroEscolhido = $(event.target)[0].getBoundingClientRect();

            sourceImage = event.target;

            const infoLivroEscolhido = informacoesLivros[livroEscolhido];

            $(".titulo-h2")[0].style.opacity = 0;
            $(".titulo-h2").text(infoLivroEscolhido.titulo);
            $(".titulo-h2")[0].style.fontSize = '2rem';
            $(".autor")[0].style.opacity = 0;
            $(".autor").text(infoLivroEscolhido.autor);
            $(".editora")[0].style.opacity = 0;
            $(".editora").text(infoLivroEscolhido.editora);
            $(".editar-infos").data("isbn", infoLivroEscolhido.isbn);

            const cloneCapa = sourceImage.cloneNode();
            cloneCapa.classList.add('clone-capa');
            cloneCapa.style.top = `${medidasLivroEscolhido.top}px`;
            cloneCapa.style.left = `${medidasLivroEscolhido.left}px`;
            cloneCapa.style.width = `${medidasLivroEscolhido.width}px`;
            cloneCapa.style.height = `${medidasLivroEscolhido.height}px`;

            document.body.appendChild(cloneCapa);

            $(".info-capa-livro")[0].src = infoLivroEscolhido.urlCapa;
            $(".info-capa-livro")[0].onload = () => {
                medidasCapa = $(".info-capa-livro")[0].getBoundingClientRect();
                
                cloneCapa.style.top = `${medidasCapa.top}px`;
                cloneCapa.style.left = `${medidasCapa.left}px`;
                cloneCapa.style.width = `${medidasCapa.width}px`;
                cloneCapa.style.height = `${medidasCapa.height}px`;

                medidasTitulo = $(".titulo-h2")[0].getBoundingClientRect();
                medidasAutor = $(".autor")[0].getBoundingClientRect();
                medidasEditora = $(".editora")[0].getBoundingClientRect();

                const medidaModal = $(".container-infos")[0].getBoundingClientRect();
                const cloneModal = document.createElement('div')
                cloneModal.classList.add('clone-info');
                cloneModal.id = 'clone-modal';
                cloneModal.style.top = `${medidaModal.top}px`;
                cloneModal.style.left = `${medidaModal.left}px`;
                cloneModal.style.width = `0`;
                cloneModal.style.borderRadius = '15px';
                cloneModal.style.backgroundColor = 'white';
                cloneModal.style.height = `${medidaModal.height}px`;

                const cloneTitulo = document.createElement('h2');
                cloneTitulo.appendChild(document.createTextNode(infoLivroEscolhido.titulo));
                cloneTitulo.classList.add('clone-info');
                cloneTitulo.id = 'clone-titulo';
                cloneTitulo.style.top = `${((medidasCapa.bottom - medidasCapa.top) / 2) + medidasCapa.top}px`;
                cloneTitulo.style.left = `${((medidasCapa.right - medidasCapa.left) / 2) + medidasCapa.left}px`;
                cloneTitulo.style.fontSize = `${$(".titulo-h2")[0].style.fontSize}`; 
                cloneTitulo.style.width = `${medidasTitulo.width}`;
                cloneTitulo.style.opacity = 0;

                const cloneAutor = document.createElement('p');
                cloneAutor.appendChild(document.createTextNode(infoLivroEscolhido.autor));
                cloneAutor.classList.add('clone-info');
                cloneAutor.style.top = `${((medidasCapa.bottom - medidasCapa.top) / 2) + medidasCapa.top}px`;
                cloneAutor.style.left = `${((medidasCapa.right - medidasCapa.left) / 2) + medidasCapa.left}px`;
                cloneAutor.style.fontSize = `${$(".autor")[0].style.fontSize}`; 
                cloneAutor.style.width = `${medidasAutor.width}`;
                cloneAutor.style.opacity = 0;

                const cloneEditora = document.createElement('p');
                cloneEditora.appendChild(document.createTextNode(infoLivroEscolhido.editora));
                cloneEditora.classList.add('clone-info');
                cloneEditora.style.top = `${((medidasCapa.bottom - medidasCapa.top) / 2) + medidasCapa.top}px`;
                cloneEditora.style.left = `${((medidasCapa.right - medidasCapa.left) / 2) + medidasCapa.left}px`;
                cloneEditora.style.fontSize = `${$(".editora")[0].style.fontSize}`; 
                cloneEditora.style.width = `${medidasEditora.width}`;
                cloneEditora.style.opacity = 0;

                document.body.appendChild(cloneModal);
                document.body.appendChild(cloneTitulo);
                document.body.appendChild(cloneAutor);
                document.body.appendChild(cloneEditora);

                cloneCapa.addEventListener('transitionend', () => {

                    cloneModal.style.width = `${medidaModal.width}px`;

                    cloneModal.addEventListener('transitionend', () => {
                        requestAnimationFrame(() => {
                            $(".fechar-modal")[0].style.top = `${medidaModal.top}px`;
                            $(".fechar-modal")[0].style.opacity = 1;
                            $(".fechar-modal")[0].style.right = `${medidaModal.right + 5}px`;
                            cloneTitulo.style.opacity = 1;
                            cloneAutor.style.opacity = 1;
                            cloneEditora.style.opacity = 1;
                            $(".container-infos").addClass("visible");

                            cloneEditora.style.left = `${medidasEditora.left}px`;
                            cloneAutor.style.left = `${medidasAutor.left}px`;
                            cloneTitulo.style.left = `${medidasTitulo.left}px`;

                            cloneTitulo.addEventListener('transitionend', () => {
                                cloneEditora.style.top = `${medidasEditora.top}px`;
                                cloneAutor.style.top = `${medidasAutor.top}px`;
                                cloneTitulo.style.top = `${medidasTitulo.top}px`;

                                cloneTitulo.addEventListener('transitionend', () => {
                                    $(".titulo-h2")[0].style.opacity = 1;
                                    $(".autor")[0].style.opacity = 1;
                                    $(".editora")[0].style.opacity = 1;
                                    cloneModal.remove();
                                    cloneCapa.remove();
                                    cloneTitulo.remove();
                                    cloneAutor.classList.add("d-none");
                                    cloneEditora.classList.add("d-none");
                                })
                            });
                        });
                    });
                });
            }

        });

        $(".fechar-modal").on("click", function() {
            const medidaModal = $(".container-infos")[0].getBoundingClientRect();
            const cloneModal = document.createElement('div')
            cloneModal.classList.add('clone-info');
            cloneModal.id = 'clone-modal';
            cloneModal.style.top = `${medidaModal.top}px`;
            cloneModal.style.left = `${medidaModal.left}px`;
            cloneModal.style.width = `${medidaModal.width}px`;
            cloneModal.style.borderRadius = '15px';
            cloneModal.style.backgroundColor = 'white';
            cloneModal.style.height = `${medidaModal.height}px`

            const cloneCapa = sourceImage.cloneNode();
            cloneCapa.classList.add('clone-capa');
            cloneCapa.style.top = `${medidasCapa.top}px`;
            cloneCapa.style.left = `${medidasCapa.left}px`;
            cloneCapa.style.width = `${medidasCapa.width}px`;
            cloneCapa.style.height = `${medidasCapa.height}px`;

            document.body.appendChild(cloneCapa);
            document.body.appendChild(cloneModal);
            $(".container-infos").removeClass("visible");

            const cloneTitulo = document.createElement('h2');
            cloneTitulo.appendChild(document.createTextNode($(".titulo-h2").text()));
            cloneTitulo.classList.add('clone-info');
            cloneTitulo.id = 'clone-titulo';
            cloneTitulo.style.top = `${medidasTitulo.top}px`;
            cloneTitulo.style.left = `${medidasTitulo.left}px`;
            cloneTitulo.style.fontSize = `${$(".titulo-h2")[0].style.fontSize}`; 
            cloneTitulo.style.width = `${medidasTitulo.width}`;

            document.body.appendChild(cloneTitulo);

            $(".titulo-h2")[0].style.opacity = 0;
            $(".editar-infos").data("isbn", "");

            requestAnimationFrame(() => {
                cloneTitulo.style.top = `${((medidasCapa.bottom - medidasCapa.top) / 2) + medidasCapa.top}px`;

                cloneTitulo.addEventListener('transitionend', () => {
                    requestAnimationFrame(() => {
                        cloneTitulo.style.left = `${medidasCapa.left}px`;

                        cloneTitulo.addEventListener('transitionend', () => {
                            requestAnimationFrame(() => {

                                cloneTitulo.remove();
                                cloneModal.style.width = '0px';
                                $(".fechar-modal")[0].style.right = `${$(".modal-info-livro")[0].getBoundingClientRect().width / 2}px`;
                                $(".fechar-modal")[0].style.opacity = 0;

                                cloneModal.addEventListener('transitionend', () => {
                                    requestAnimationFrame(() => {
                                        cloneModal.remove();

                                        medidasLivroEscolhido = $(`#${livroEscolhido}`)[0].children[0].getBoundingClientRect();

                                        cloneCapa.style.top = `${medidasLivroEscolhido.top}px`;
                                        cloneCapa.style.left = `${medidasLivroEscolhido.left}px`;
                                        cloneCapa.style.width = `${medidasLivroEscolhido.width}px`;
                                        cloneCapa.style.height = `${medidasLivroEscolhido.height}px`;

                                        cloneCapa.addEventListener('transitionend', () => {
                                            requestAnimationFrame(() => {
                                                $('.modal-info-livro').removeClass('visible');
                                                document.body.style.overflow = '';
                                                document.body.style.paddingRight = ``;
                                                cloneCapa.remove();
                                            })
                                        })
                                    })
                                })
                            });
                        });
                    });               
                });
            });

        });

        $(".editar-infos").on("click", function() {
            window.location.href = `cadastroLivro.html?livro=${$(this).data("isbn")}`;
        });

        $(".btn-add-livro").on("click", function() {
            window.location.href = "cadastroLivro.html";
        });

    });

</script>